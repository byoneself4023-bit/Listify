<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Listify API í…ŒìŠ¤íŠ¸</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      color: #fff;
      padding: 2rem;
    }

    h1 {
      text-align: center;
      margin-bottom: 2rem;
      background: linear-gradient(90deg, #1db954, #1ed760);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-size: 2.5rem;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 1.5rem;
    }

    .card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 1.5rem;
      backdrop-filter: blur(10px);
    }

    .card.wide {
      grid-column: span 2;
    }

    .card h2 {
      color: #1db954;
      margin-bottom: 1rem;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .card h2::before {
      content: '';
      width: 8px;
      height: 8px;
      background: #1db954;
      border-radius: 50%;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    label {
      display: block;
      margin-bottom: 0.3rem;
      color: #aaa;
      font-size: 0.85rem;
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.3);
      color: #fff;
      font-size: 0.95rem;
      transition: border-color 0.2s;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #1db954;
    }

    button {
      width: 100%;
      padding: 0.75rem;
      background: linear-gradient(90deg, #1db954, #1ed760);
      border: none;
      border-radius: 8px;
      color: #000;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(29, 185, 84, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    button.danger {
      background: linear-gradient(90deg, #e74c3c, #c0392b);
    }

    button.secondary {
      background: linear-gradient(90deg, #3498db, #2980b9);
    }

    .response-box {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 8px;
      font-family: 'Consolas', monospace;
      font-size: 0.85rem;
      max-height: 150px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .response-box.success {
      border-left: 4px solid #1db954;
    }

    .response-box.error {
      border-left: 4px solid #e74c3c;
    }

    .status-bar {
      background: rgba(0, 0, 0, 0.5);
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .status-item span:first-child {
      color: #888;
      font-size: 0.85rem;
    }

    .status-item span:last-child {
      background: rgba(29, 185, 84, 0.2);
      color: #1db954;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }

    .status-item.disconnected span:last-child {
      background: rgba(231, 76, 60, 0.2);
      color: #e74c3c;
    }

    .list-container {
      margin-top: 1rem;
      max-height: 300px;
      overflow-y: auto;
    }

    .list-item {
      background: rgba(0, 0, 0, 0.3);
      padding: 0.75rem;
      border-radius: 8px;
      margin-bottom: 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.2s;
    }

    .list-item:hover {
      background: rgba(0, 0, 0, 0.5);
    }

    .list-item .info {
      flex: 1;
      min-width: 0;
    }

    .list-item .title {
      font-weight: bold;
      color: #fff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .list-item .meta {
      font-size: 0.8rem;
      color: #888;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .list-item .actions {
      display: flex;
      gap: 0.5rem;
      flex-shrink: 0;
    }

    .list-item button {
      width: auto;
      padding: 0.4rem 0.8rem;
      font-size: 0.75rem;
    }

    .music-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .music-item img {
      width: 40px;
      height: 40px;
      border-radius: 4px;
      object-fit: cover;
    }

    .btn-group {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .btn-group button {
      flex: 1;
    }

    .tab-buttons {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .tab-buttons button {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
    }

    .tab-buttons button.active {
      background: linear-gradient(90deg, #1db954, #1ed760);
      color: #000;
    }

    .search-box {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .search-box input {
      flex: 1;
    }

    .search-box button {
      width: auto;
      padding: 0.75rem 1.5rem;
    }
  </style>
</head>

<body>
  <h1>ğŸµ Listify API í…ŒìŠ¤íŠ¸</h1>

  <div class="status-bar">
    <div class="status-item" id="loginStatus">
      <span>ë¡œê·¸ì¸ ìƒíƒœ:</span>
      <span>ë¡œê·¸ì¸ í•„ìš”</span>
    </div>
    <div class="status-item" id="userInfo" style="display:none;">
      <span>ì‚¬ìš©ì:</span>
      <span id="userNickname">-</span>
    </div>
    <div class="status-item" id="tokenInfo" style="display:none;">
      <span>Token:</span>
      <span id="tokenPreview">-</span>
    </div>
    <button onclick="logout()" style="width:auto; padding:0.5rem 1rem; font-size:0.85rem;" class="danger">ë¡œê·¸ì•„ì›ƒ</button>
  </div>

  <div class="container">
    <!-- íšŒì›ê°€ì… -->
    <div class="card">
      <h2>1. íšŒì›ê°€ì…</h2>
      <div class="form-group">
        <label>ì´ë©”ì¼</label>
        <input type="email" id="regEmail" placeholder="test@example.com" value="test@listify.com">
      </div>
      <div class="form-group">
        <label>ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" id="regPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" value="test1234">
      </div>
      <div class="form-group">
        <label>ë‹‰ë„¤ì„</label>
        <input type="text" id="regNickname" placeholder="ë‹‰ë„¤ì„" value="í…ŒìŠ¤íŠ¸ìœ ì €">
      </div>
      <button onclick="register()">íšŒì›ê°€ì…</button>
      <div class="response-box" id="regResponse">ì‘ë‹µ ëŒ€ê¸° ì¤‘...</div>
    </div>

    <!-- ë¡œê·¸ì¸ -->
    <div class="card">
      <h2>2. ë¡œê·¸ì¸</h2>
      <div class="form-group">
        <label>ì´ë©”ì¼</label>
        <input type="email" id="loginEmail" placeholder="test@example.com" value="test@listify.com">
      </div>
      <div class="form-group">
        <label>ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" value="test1234">
      </div>
      <button onclick="login()">ë¡œê·¸ì¸</button>
      <div class="response-box" id="loginResponse">ì‘ë‹µ ëŒ€ê¸° ì¤‘...</div>
    </div>

    <!-- í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„± -->
    <div class="card">
      <h2>3. í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„±</h2>
      <div class="form-group">
        <label>ì œëª©</label>
        <input type="text" id="createTitle" placeholder="í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì œëª©" value="ë‚˜ì˜ ì²« í”Œë ˆì´ë¦¬ìŠ¤íŠ¸">
      </div>
      <div class="form-group">
        <label>ì„¤ëª…</label>
        <textarea id="createContent" placeholder="í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì„¤ëª…" rows="2">ì¢‹ì•„í•˜ëŠ” ë…¸ë˜ ëª¨ìŒ</textarea>
      </div>
      <button onclick="createPlaylist()">í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„±</button>
      <div class="response-box" id="createResponse">ì‘ë‹µ ëŒ€ê¸° ì¤‘...</div>
    </div>

    <!-- í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìˆ˜ì • -->
    <div class="card">
      <h2>4. í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìˆ˜ì •</h2>
      <div class="form-group">
        <label>í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë²ˆí˜¸</label>
        <input type="number" id="updateNo" placeholder="playlist_no" value="1">
      </div>
      <div class="form-group">
        <label>ìƒˆ ì œëª©</label>
        <input type="text" id="updateTitle" placeholder="ìƒˆ ì œëª©" value="ìˆ˜ì •ëœ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸">
      </div>
      <div class="form-group">
        <label>ìƒˆ ì„¤ëª…</label>
        <textarea id="updateContent" placeholder="ìƒˆ ì„¤ëª…" rows="2">ìˆ˜ì •ëœ ì„¤ëª…ì…ë‹ˆë‹¤</textarea>
      </div>
      <button onclick="updatePlaylist()">í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìˆ˜ì •</button>
      <div class="response-box" id="updateResponse">ì‘ë‹µ ëŒ€ê¸° ì¤‘...</div>
    </div>

    <!-- í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì‚­ì œ -->
    <div class="card">
      <h2>5. í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì‚­ì œ</h2>
      <div class="form-group">
        <label>í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë²ˆí˜¸</label>
        <input type="number" id="deleteNo" placeholder="playlist_no" value="1">
      </div>
      <button onclick="deletePlaylist()" class="danger">í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì‚­ì œ</button>
      <div class="response-box" id="deleteResponse">ì‘ë‹µ ëŒ€ê¸° ì¤‘...</div>
    </div>

    <!-- ë‚´ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ -->
    <div class="card">
      <h2>6. ë‚´ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ</h2>
      <button onclick="getMyPlaylists()">ë‚´ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°</button>
      <div class="response-box" id="listResponse">ì‘ë‹µ ëŒ€ê¸° ì¤‘...</div>
      <div class="list-container" id="playlistList"></div>
    </div>

    <!-- ì „ì²´ ìŒì•… ëª©ë¡ -->
    <div class="card wide">
      <h2>7. ì „ì²´ ìŒì•… ëª©ë¡</h2>
      <div class="search-box">
        <input type="text" id="musicSearch" placeholder="ìŒì•… ê²€ìƒ‰ (ì œëª© ë˜ëŠ” ì•„í‹°ìŠ¤íŠ¸)">
        <button onclick="getAllMusic()">ìŒì•… ë¶ˆëŸ¬ì˜¤ê¸°</button>
      </div>
      <div class="form-group">
        <label>ì¶”ê°€í•  í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì„ íƒ</label>
        <select id="targetPlaylist">
          <option value="">-- ë¨¼ì € í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¥¼ ì¡°íšŒí•˜ì„¸ìš” --</option>
        </select>
      </div>
      <div class="response-box" id="musicResponse">ì‘ë‹µ ëŒ€ê¸° ì¤‘...</div>
      <div class="list-container" id="musicList"></div>
    </div>

    <!-- í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìŒì•… ê´€ë¦¬ -->
    <div class="card wide">
      <h2>8. í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìŒì•… ê´€ë¦¬</h2>
      <div class="btn-group">
        <div class="form-group" style="flex:1; margin-bottom:0;">
          <label>í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë²ˆí˜¸</label>
          <input type="number" id="playlistMusicNo" placeholder="playlist_no" value="1">
        </div>
        <button onclick="getPlaylistMusic()" style="align-self:flex-end;">ìŒì•… ëª©ë¡ ì¡°íšŒ</button>
      </div>
      <div class="response-box" id="playlistMusicResponse">ì‘ë‹µ ëŒ€ê¸° ì¤‘...</div>
      <div class="list-container" id="playlistMusicList"></div>
    </div>
  </div>

  <script>
    const API_BASE = 'https://lemon-lies-scream.loca.lt';
    let allMusicData = [];

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ í† í° í™•ì¸
    window.onload = () => {
      updateStatusBar();
    };

    function getToken() {
      return localStorage.getItem('access_token');
    }

    function getUserNo() {
      return localStorage.getItem('user_no');
    }

    function updateStatusBar() {
      const token = getToken();
      const nickname = localStorage.getItem('nickname');
      const loginStatus = document.getElementById('loginStatus');
      const userInfo = document.getElementById('userInfo');
      const tokenInfo = document.getElementById('tokenInfo');

      if (token) {
        loginStatus.innerHTML = '<span>ë¡œê·¸ì¸ ìƒíƒœ:</span><span>ë¡œê·¸ì¸ë¨ âœ“</span>';
        loginStatus.classList.remove('disconnected');
        userInfo.style.display = 'flex';
        tokenInfo.style.display = 'flex';
        document.getElementById('userNickname').textContent = nickname || '-';
        document.getElementById('tokenPreview').textContent = token.substring(0, 20) + '...';
      } else {
        loginStatus.innerHTML = '<span>ë¡œê·¸ì¸ ìƒíƒœ:</span><span>ë¡œê·¸ì¸ í•„ìš”</span>';
        loginStatus.classList.add('disconnected');
        userInfo.style.display = 'none';
        tokenInfo.style.display = 'none';
      }
    }

    function showResponse(elementId, data, isSuccess) {
      const el = document.getElementById(elementId);
      el.textContent = JSON.stringify(data, null, 2);
      el.className = 'response-box ' + (isSuccess ? 'success' : 'error');
    }

    async function register() {
      const email = document.getElementById('regEmail').value;
      const password = document.getElementById('regPassword').value;
      const nickname = document.getElementById('regNickname').value;

      try {
        const res = await fetch(`${API_BASE}/auth/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password, nickname })
        });
        const data = await res.json();
        showResponse('regResponse', data, data.success);
      } catch (e) {
        showResponse('regResponse', { error: e.message }, false);
      }
    }

    async function login() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      try {
        const res = await fetch(`${API_BASE}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        const data = await res.json();
        showResponse('loginResponse', data, data.success);

        if (data.success && data.data) {
          localStorage.setItem('access_token', data.data.access_token);
          localStorage.setItem('user_no', data.data.user_no);
          localStorage.setItem('nickname', data.data.nickname);
          updateStatusBar();
        }
      } catch (e) {
        showResponse('loginResponse', { error: e.message }, false);
      }
    }

    function logout() {
      localStorage.removeItem('access_token');
      localStorage.removeItem('user_no');
      localStorage.removeItem('nickname');
      updateStatusBar();
      alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    async function createPlaylist() {
      const token = getToken();
      if (!token) {
        showResponse('createResponse', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
        return;
      }

      const title = document.getElementById('createTitle').value;
      const content = document.getElementById('createContent').value;

      try {
        const res = await fetch(`${API_BASE}/playlist`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ title, content })
        });
        const data = await res.json();
        showResponse('createResponse', data, data.success);

        if (data.success && data.data) {
          document.getElementById('updateNo').value = data.data.playlist_no;
          document.getElementById('deleteNo').value = data.data.playlist_no;
          document.getElementById('playlistMusicNo').value = data.data.playlist_no;
          getMyPlaylists(); // í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        }
      } catch (e) {
        showResponse('createResponse', { error: e.message }, false);
      }
    }

    async function updatePlaylist() {
      const token = getToken();
      if (!token) {
        showResponse('updateResponse', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
        return;
      }

      const playlistNo = document.getElementById('updateNo').value;
      const title = document.getElementById('updateTitle').value;
      const content = document.getElementById('updateContent').value;

      try {
        const res = await fetch(`${API_BASE}/playlist/${playlistNo}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ title, content })
        });
        const data = await res.json();
        showResponse('updateResponse', data, data.success);
      } catch (e) {
        showResponse('updateResponse', { error: e.message }, false);
      }
    }

    async function deletePlaylist() {
      const token = getToken();
      if (!token) {
        showResponse('deleteResponse', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
        return;
      }

      const playlistNo = document.getElementById('deleteNo').value;

      if (!confirm(`í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ #${playlistNo}ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

      try {
        const res = await fetch(`${API_BASE}/playlist/${playlistNo}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        const data = await res.json();
        showResponse('deleteResponse', data, data.success);
        if (data.success) getMyPlaylists();
      } catch (e) {
        showResponse('deleteResponse', { error: e.message }, false);
      }
    }

    async function getMyPlaylists() {
      const token = getToken();
      const userNo = getUserNo();

      if (!token || !userNo) {
        showResponse('listResponse', { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, false);
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/playlist/user/${userNo}`, {
          method: 'GET',
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const data = await res.json();
        showResponse('listResponse', data, data.success);

        const listEl = document.getElementById('playlistList');
        const selectEl = document.getElementById('targetPlaylist');

        if (data.success && data.data && Array.isArray(data.data)) {
          // í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ëª©ë¡ ë Œë”ë§
          listEl.innerHTML = data.data.map(p => `
            <div class="list-item">
              <div class="info">
                <div class="title">#${p.playlist_no} ${p.title}</div>
                <div class="meta">${p.content || 'ì„¤ëª… ì—†ìŒ'}</div>
              </div>
              <div class="actions">
                <button onclick="document.getElementById('playlistMusicNo').value=${p.playlist_no}; getPlaylistMusic();" class="secondary">ìŒì•…ë³´ê¸°</button>
                <button onclick="document.getElementById('updateNo').value=${p.playlist_no}; document.getElementById('updateTitle').value='${p.title}';">ìˆ˜ì •</button>
                <button onclick="document.getElementById('deleteNo').value=${p.playlist_no};" class="danger">ì‚­ì œ</button>
              </div>
            </div>
          `).join('');

          // í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
          selectEl.innerHTML = '<option value="">-- í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì„ íƒ --</option>' +
            data.data.map(p => `<option value="${p.playlist_no}">#${p.playlist_no} ${p.title}</option>`).join('');
        } else {
          listEl.innerHTML = '<p style="color:#888; text-align:center; padding:1rem;">í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
          selectEl.innerHTML = '<option value="">-- í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì—†ìŒ --</option>';
        }
      } catch (e) {
        showResponse('listResponse', { error: e.message }, false);
      }
    }

    // ===== ìŒì•… ê´€ë ¨ í•¨ìˆ˜ =====

    async function getAllMusic() {
      try {
        const res = await fetch(`${API_BASE}/music`, { method: 'GET' });
        const data = await res.json();
        showResponse('musicResponse', { success: data.success, count: data.data?.length || 0 }, data.success);

        allMusicData = data.data || [];
        renderMusicList();
      } catch (e) {
        showResponse('musicResponse', { error: e.message }, false);
      }
    }

    function renderMusicList() {
      const searchTerm = document.getElementById('musicSearch').value.toLowerCase();
      const filteredMusic = allMusicData.filter(m =>
        m.track_name.toLowerCase().includes(searchTerm) ||
        m.artist_name.toLowerCase().includes(searchTerm)
      );

      const listEl = document.getElementById('musicList');
      if (filteredMusic.length === 0) {
        listEl.innerHTML = '<p style="color:#888; text-align:center; padding:1rem;">ìŒì•…ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }

      listEl.innerHTML = filteredMusic.slice(0, 50).map(m => `
        <div class="list-item">
          <div class="music-item">
            <img src="${m.album_image_url || 'https://via.placeholder.com/40'}" alt="album">
            <div class="info">
              <div class="title">${m.track_name}</div>
              <div class="meta">${m.artist_name} Â· ${m.album_name}</div>
            </div>
          </div>
          <div class="actions">
            <button onclick="addMusicToPlaylist(${m.music_no})">+ ì¶”ê°€</button>
          </div>
        </div>
      `).join('');
    }

    // ê²€ìƒ‰ ì…ë ¥ ì‹œ í•„í„°ë§
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('musicSearch').addEventListener('input', renderMusicList);
    });

    async function addMusicToPlaylist(musicNo) {
      const token = getToken();
      if (!token) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
      }

      const playlistNo = document.getElementById('targetPlaylist').value;
      if (!playlistNo) {
        alert('ì¶”ê°€í•  í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/playlist/${playlistNo}/music`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ music_no: musicNo })
        });
        const data = await res.json();

        if (data.success) {
          alert(`ìŒì•…ì´ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ #${playlistNo}ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
          // í˜„ì¬ ì¡°íšŒ ì¤‘ì¸ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
          if (document.getElementById('playlistMusicNo').value == playlistNo) {
            getPlaylistMusic();
          }
        } else {
          alert('ì¶”ê°€ ì‹¤íŒ¨: ' + data.message);
        }
      } catch (e) {
        alert('ì˜¤ë¥˜: ' + e.message);
      }
    }

    async function getPlaylistMusic() {
      const playlistNo = document.getElementById('playlistMusicNo').value;
      if (!playlistNo) {
        showResponse('playlistMusicResponse', { error: 'í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.' }, false);
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/playlist/${playlistNo}/music`, { method: 'GET' });
        const data = await res.json();
        showResponse('playlistMusicResponse', data, data.success);

        const listEl = document.getElementById('playlistMusicList');
        const musicList = data.data?.music_list || [];

        if (musicList.length === 0) {
          listEl.innerHTML = '<p style="color:#888; text-align:center; padding:1rem;">í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ì— ìŒì•…ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
          return;
        }

        listEl.innerHTML = musicList.map(m => `
          <div class="list-item">
            <div class="music-item">
              <img src="${m.album_image_url || 'https://via.placeholder.com/40'}" alt="album">
              <div class="info">
                <div class="title">${m.track_name}</div>
                <div class="meta">${m.artist_name} Â· ${m.album_name}</div>
              </div>
            </div>
            <div class="actions">
              <button onclick="removeMusicFromPlaylist(${playlistNo}, ${m.music_no})" class="danger">ì‚­ì œ</button>
            </div>
          </div>
        `).join('');
      } catch (e) {
        showResponse('playlistMusicResponse', { error: e.message }, false);
      }
    }

    async function removeMusicFromPlaylist(playlistNo, musicNo) {
      const token = getToken();
      if (!token) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
      }

      if (!confirm('ì´ ìŒì•…ì„ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ì—ì„œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      try {
        const res = await fetch(`${API_BASE}/playlist/${playlistNo}/music/${musicNo}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const data = await res.json();

        if (data.success) {
          alert('ìŒì•…ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          getPlaylistMusic();
        } else {
          alert('ì‚­ì œ ì‹¤íŒ¨: ' + data.message);
        }
      } catch (e) {
        alert('ì˜¤ë¥˜: ' + e.message);
      }
    }
  </script>
</body>

</html>